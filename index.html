<!DOCTYPE html>
<html lang="it">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mixed by Genny - Menu</title>
  <link rel="stylesheet" href="style.css" />
  <!-- Altri CSS o script se presenti -->
  <style>
    /* Qui mantieni i tuoi stili CSS esistenti per il popup e la pagina */
  </style>
</head>

<body>
  <header>
    <img src="logo.png" alt="Logo Mixed by Genny" />
  </header>

  <main>
    <div class="pizza margherita">
      <img src="diavola1.jpeg" alt="Margherita" />
      <div class="pizza-info">
        <p class="pizza-name">Margherita</p>
        <p class="pizza-ingredients">Pomodoro, mozzarella, basilico<br><em>Tomato, mozzarella, basil</em></p>
        <p class="pizza-price">10‚Ç¨</p>
      </div>
    </div>

    <div class="pizza diavola1">
      <img src="diavola1.jpeg" alt="Diavola" />
      <div class="pizza-info">
        <p class="pizza-name">Diavola</p>
        <p class="pizza-ingredients">Mozzarella, pomodoro, salame piccante<br><em>Mozzarella, tomato, spicy salami</em></p>
        <p class="pizza-price">10‚Ç¨</p>
      </div>
    </div>

    <div class="pizza gorgonzola">
      <img src="diavola1.jpeg" alt="Gorgonzola" />
      <div class="pizza-info">
        <p class="pizza-name">Gorgonzola</p>
        <p class="pizza-ingredients">Mozzarella, gorgonzola, noci<br><em>Mozzarella, gorgonzola, walnuts</em></p>
        <p class="pizza-price">10‚Ç¨</p>
      </div>
    </div>

    <div class="pizza mixed">
      <img src="diavola1.jpeg" alt="Mixed by Genny" />
      <div class="pizza-info">
        <p class="pizza-name">Mixed by Genny</p>
        <p class="pizza-ingredients">Interagisci con l'AI e Genny far√† una pizza speciale solo per te<br><em>Interact with the AI and Genny will make a special pizza for you</em></p>
        <p class="pizza-price">10‚Ç¨</p>
      </div>
    </div>
  </main>

  <div id="ai-fab" onclick="togglePopup()">AI</div>

  <div id="ai-popup">
    <div class="lang-switch">
      <button onclick="setLang('it')">üáÆüáπ</button>
      <button onclick="setLang('en')">üá¨üáß</button>
    </div>
    <div class="popup-content">
      <h2 id="title-prompt">Dimmi cosa ti piace!</h2>
      <input type="text" id="gusto" placeholder="Es: mozzarella, pomodoro" />
      <button onclick="consiglia()">Scrivimi i tuoi gusti üçï</button>
      <button onclick="parla()">üéôÔ∏è Parla con me</button>
      <div id="risposta-ai"></div>
    </div>
  </div>

  <footer>
    Coperto: 2‚Ç¨ a persona (include acqua da 50ml)
  </footer>

  <script>
    let currentLang = 'it';

    function setLang(lang) {
      currentLang = lang;
      document.documentElement.lang = lang;
      document.getElementById("title-prompt").textContent = lang === 'it' ? "Dimmi cosa ti piace!" : "Tell me what you like!";
      document.getElementById("gusto").placeholder = lang === 'it' ? "Es: mozzarella, pomodoro" : "E.g.: mozzarella, tomato";
    }

    function togglePopup() {
      const popup = document.getElementById("ai-popup");
      popup.style.display = popup.style.display === "block" ? "none" : "block";
    }

    async function consiglia() {
      const gustoInput = document.getElementById('gusto').value.trim();
      const rispostaDiv = document.getElementById('risposta-ai');
      if (!gustoInput) {
        rispostaDiv.textContent = currentLang === 'it' ? "Inserisci qualche ingrediente!" : "Please enter some ingredients!";
        return;
      }

      const data = await chiediConsiglio(gustoInput);
      rispostaDiv.textContent = data.risposta;

      // Voce (una sola lettura)
      if ('speechSynthesis' in window) {
        window.speechSynthesis.cancel(); // stop eventuali speech in corso
        const utter = new SpeechSynthesisUtterance(data.risposta);
        utter.lang = currentLang === 'it' ? 'it-IT' : 'en-US';
        window.speechSynthesis.speak(utter);
      }
    }

    function parla() {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SpeechRecognition) {
        alert(currentLang === 'it' ? "Il tuo browser non supporta il riconoscimento vocale." : "Your browser does not support voice recognition.");
        return;
      }
      const recognition = new SpeechRecognition();
      recognition.lang = currentLang === 'it' ? 'it-IT' : 'en-US';
      recognition.start();

      const rispostaDiv = document.getElementById('risposta-ai');
      rispostaDiv.textContent = currentLang === 'it' ? "Sto ascoltando... üéß" : "Listening... üéß";

      recognition.onresult = async (event) => {
        const input = event.results[0][0].transcript;
        document.getElementById('gusto').value = input;
        rispostaDiv.textContent = currentLang === 'it' ? "Elaboro... ü§ñ" : "Processing... ü§ñ";
        const data = await chiediConsiglio(input);
        rispostaDiv.textContent = data.risposta;
        if ('speechSynthesis' in window) {
          window.speechSynthesis.cancel();
          const utter = new SpeechSynthesisUtterance(data.risposta);
          utter.lang = currentLang === 'it' ? 'it-IT' : 'en-US';
          window.speechSynthesis.speak(utter);
        }
      };

      recognition.onerror = (event) => {
        rispostaDiv.textContent = currentLang === 'it' ? "Errore nel riconoscimento vocale." : "Speech recognition error.";
      };
    }

    // --- AI avanzata con tanti ingredienti e stati d'animo ---
    const ingredientiAI = [
      "mozzarella", "pomodoro", "salame", "funghi", "carciofi", "olive", "tonno", "cipolla", "peperoni",
      "gorgonzola", "basilico", "zucchine", "melanzane", "salsiccia", "bufala", "scamorza", "provola",
      "pancetta", "prosciutto", "acciughe", "uovo", "panna", "tartufo", "rucola", "pomodorini", "origano",
      "grana", "fontina", "speck", "wurstel", "radicchio", "crema di tartufo", "formaggio di capra", "porcini",
      "bresaola", "limone", "lattuga", "mais", "avocado", "zucca", "miele", "nocciole", "pesto", "cetrioli",
      "peperoncino", "carne macinata", "pollo", "hamburger", "uova strapazzate", "emmental", "camembert",
      "blue cheese", "ricotta", "spinaci", "patate", "patatine", "rosmarino", "asparagi", "prosciutto crudo",
      "capperi", "mandorle", "cioccolato", "nutella", "fragole", "banana", "ciliegie", "pistacchi", "lime",
      "cocco", "ananas", "jalapeno", "senape", "ketchup", "salsa barbecue", "tabasco", "formaggio fuso",
      "crema di funghi", "crema di peperoni", "crema di zucca", "pomodori secchi", "carne affumicata",
      "salmone", "gamberi", "cozze", "polpo", "tonno affumicato", "calamari", "crema di gamberi", "zenzero",
      "aglio", "cipollotto", "barbabietola", "ravanelli", "cavolo", "funghi shitake", "alghe", "wasabi"
    ];

    const emozioniAI = {
      triste: ["triste", "gi√π", "deluso", "depresso", "cupo"],
      felice: ["felice", "contento", "allegro", "raggiante", "gioioso"],
      arrabbiato: ["arrabbiato", "furioso", "agitato", "irritato", "nervoso"],
      stressato: ["stressato", "teso", "ansioso", "esausto", "carico"],
      curioso: ["curioso", "sognante", "strano", "fantasioso", "sperimentale"],
      romantico: ["romantico", "innamorato", "dolce", "tenero", "sentimentale"],
      energico: ["energico", "attivo", "vivace", "dinamico", "euforico"],
      rilassato: ["rilassato", "tranquillo", "sereno", "calmo", "zen"]
    };

    function trovaEmozione(testo) {
      const input = testo.toLowerCase();
      for (const [emozione, sinonimi] of Object.entries(emozioniAI)) {
        if (sinonimi.some(p => input.includes(p))) {
          return emozione;
        }
      }
      return null;
    }

    function trovaIngredienti(testo) {
      const input = testo.toLowerCase();
      return ingredientiAI.filter(ingrediente => input.includes(ingrediente));
    }

    async function chiediConsiglio(inputUtente) {
      return new Promise((resolve) => {
        const umore = trovaEmozione(inputUtente);
        const ingredienti = trovaIngredienti(inputUtente);
        let risposta = "";

        if (ingredienti.includes("nutella") || (umore === "stressato" && inputUtente.toLowerCase().includes("dolce"))) {
          risposta = currentLang === 'it' ? "Hai avuto una giornata pesante. Ti consiglio una pizza alla Nutella per chiuderla con dolcezza." : "Had a tough day? I suggest a Nutella pizza to sweeten it up.";
        } else if (ingredienti.length > 0) {
          risposta = currentLang === 'it' ?
            `Con gli ingredienti che hai scelto (${ingredienti.join(", ")}), potremmo creare una pizza su misura per te.` :
            `With the ingredients you chose (${ingredienti.join(", ")}), we could create a custom pizza just for you.`;
        } else if (umore) {
          const suggerimenti = {
            triste: currentLang === 'it' ?
              "Prova una Boscaiola: cremosa e intensa, per tirarti su." :
              "Try a Boscaiola: creamy and intense to lift your mood.",
            felice: currentLang === 'it' ?
              "Festeggia con una Capricciosa, ricca e piena di sapore." :
              "Celebrate with a Capricciosa, rich and full of flavor.",
            arrabbiato: currentLang === 'it' ?
              "Sfogati con una Diavola molto piccante." :
              "Let it out with a very spicy Diavola.",
            stressato: currentLang === 'it' ?
              "Rilassati con una Margherita semplice e perfetta." :
              "Relax with a simple and perfect Margherita.",
            curioso: currentLang === 'it' ?
              "Prova una Tartufata, elegante e fuori dal comune." :
              "Try a Tartufata, elegant and unusual.",
            romantico: currentLang === 'it' ?
              "Una Bufalina delicata √® perfetta per un momento speciale." :
              "A delicate Bufalina is perfect for a special moment.",
            energico: currentLang === 'it' ?
              "Lanciati con una Quattro Formaggi ricca e decisa." :
              "Go for a rich and bold Quattro Formaggi.",
            rilassato: currentLang === 'it' ?
              "Una Vegetariana leggera si abbina al tuo stato d‚Äôanimo." :
              "A light Vegetarian pizza matches your mood."
          };
          risposta = suggerimenti[umore];
        } else {
          risposta = currentLang === 'it' ?
            "Dimmi come ti senti o cosa ti piace, e ti consiglier√≤ la pizza perfetta." :
            "Tell me how you feel or what you like, and I'll recommend the perfect pizza.";
        }

        resolve({ risposta });
      });
    }
  </script>
</body>

</html>
